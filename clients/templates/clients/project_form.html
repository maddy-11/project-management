{% extends 'clients/home.html' %}
{% load widget_tweaks %}

{% block content %}
<div class="container-fluid my-4">
  <div class="card shadow-sm border-0">
    <div class="card-header bg-light d-flex align-items-center justify-content-between">
      <h3 class="mb-0">
        <i class="fa fa-tasks me-2"></i> {{ form.instance.pk|yesno:"Edit Project,Add Project" }}
      </h3>
    </div>

    <form method="post" class="card-body">
      {% csrf_token %}
      {% if form.non_field_errors %}
      <div class="alert alert-danger" role="alert">{{ form.non_field_errors }}</div>
      {% endif %}
      {% for field in form.visible_fields %}
      {% for error in field.errors %}
      <div class="alert alert-danger" role="alert">{{ error }}</div>
      {% endfor %}
      {% endfor %}

      <div class="row g-3">
        <!-- Name Field -->
        <div class="col-md-12">
          <label for="id_name" class="form-label fw-medium">
            Project Name{% if form.fields.name.required %}<span class="text-danger">*</span>{% endif %}
          </label>
          {{ form.name|add_class:"form-control" }}
          {% if form.name.errors %}
          <div class="invalid-feedback d-block">{{ form.name.errors }}</div>
          {% endif %}
          <small class="form-text text-muted">Enter the project name</small>
        </div>

        <!-- Partner and Project Type Fields -->
        <div class="col-md-6">
          <label for="id_partner" class="form-label fw-medium">
            Partner{% if form.fields.partner.required %}<span class="text-danger">*</span>{% endif %}
          </label>
          {{ form.partner|add_class:"form-select" }}
          {% if form.partner.errors %}
          <div class="invalid-feedback d-block">{{ form.partner.errors }}</div>
          {% endif %}
        </div>

        <div class="col-md-6">
          <label for="id_project_type" class="form-label fw-medium">Project Type</label>
          {{ form.project_type|add_class:"form-select" }}
          <small class="form-text text-muted">Select the project category</small>
        </div>

        <!-- Description Field -->
        <div class="col-md-12">
          <label for="id_description" class="form-label fw-medium">
            Description{% if form.fields.description.required %}<span class="text-danger">*</span>{% endif %}
          </label>
          {{ form.description|add_class:"form-control"|attr:"style:height:100px" }}
          {% if form.description.errors %}
          <div class="invalid-feedback d-block">{{ form.description.errors }}</div>
          {% endif %}
          <small class="form-text text-muted">Provide a detailed project description</small>
        </div>

        <!-- Members Field -->
        <div class="col-md-12">
          <label for="id_members" class="form-label fw-medium">Members</label>
          {{ form.members|add_class:"form-select"|attr:"multiple:true size:5" }}
          <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple members</small>
          {% if form.members.errors %}
          <div class="invalid-feedback d-block">{{ form.members.errors }}</div>
          {% endif %}
        </div>

        <!-- Link Field -->
        <div class="col-md-12">
          <label for="id_link" class="form-label fw-medium">Link</label>
          {{ form.link|add_class:"form-control" }}
        </div>
        <small class="form-text text-muted">Enter the project link</small>
      </div>
      <div class="mt-4 d-flex justify-content-center gap-3">
        <button type="submit" class="btn btn-primary">
          <i class="fa-solid fa-save me-1"></i>Save
        </button>
        <a href="{% url 'project-list' %}" class="btn btn-outline-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>

{% endblock %}

{% block js %}
<!-- Select2 CSS/JS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<style>
/* General Form Styling */
.card {
  border-radius: 0.5rem;
}
.form-label {
  font-weight: 500;
  color: #343a40;
}
.form-control, .form-select {
  border-radius: 0.375rem;
  border: 1px solid #ced4da;
  transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}
.form-control:focus, .form-select:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}
.form-text {
  font-size: 0.875rem;
  color: #6c757d;
}
.alert {
  border-radius: 0.375rem;
}

/* Select2 Styling */
.select2-container--bootstrap-5 .select2-selection--multiple {
  min-height: 38px;
  border-radius: 0.375rem;
  border: 1px solid #ced4da;
  padding: 0.25rem;
}
.select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice {
  background-color: #e9ecef;
  color: #212529;
  border: none;
  border-radius: 1rem;
  padding: 0.25rem 0.75rem;
  margin: 0.25rem;
  font-size: 0.875rem;
}
.select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice__remove {
  color: #6c757d;
  margin-left: 0.5rem;
  font-weight: bold;
  cursor: pointer;
}
</style>

<script>
$(document).ready(function() {
  // Initialize Select2
  $('#id_members').select2({
    theme: 'bootstrap-5',
    placeholder: 'Search and add members...',
    allowClear: true,
    width: '100%'
  });
});
</script>
{% endblock %}